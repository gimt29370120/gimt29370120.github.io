<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音量控制圓點亮度</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #fff;
            margin: 0;
        }
        .dot {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: rgb(0, 0, 0); /* 初始為黑色 */
            transition: background-color 0.1s linear;
        }
    </style>
</head>
<body>
    <div class="dot"></div>

    <script>
        async function startAudioProcessing() {
            try {
                // 獲取麥克風音訊
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

                // 建立 Web Audio API 上下文
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(stream);
                const analyser = audioContext.createAnalyser();

                // 設定分析器參數
                analyser.fftSize = 256;
                const dataArray = new Uint8Array(analyser.frequencyBinCount);

                source.connect(analyser);

                function updateDotBrightness() {
                    analyser.getByteFrequencyData(dataArray);
                    
                    // 計算平均音量
                    let sum = 0;
                    for (let i = 0; i < dataArray.length; i++) {
                        sum += dataArray[i];
                    }
                    const average = sum / dataArray.length;

                    // 轉換為亮度 (0 ~ 255)（數值越高越白）
                    const brightness = Math.min(255, Math.max(0, average * 2));

                    // 改變圓點亮度
                    document.querySelector('.dot').style.backgroundColor = `rgb(${brightness}, ${brightness}, ${brightness})`;

                    requestAnimationFrame(updateDotBrightness);
                }

                updateDotBrightness();
            } catch (err) {
                console.error('無法取得音訊輸入：', err);
            }
        }

        startAudioProcessing();
    </script>
</body>
</html>