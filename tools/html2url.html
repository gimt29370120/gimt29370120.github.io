<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HTML → Data URL 工具</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:18px;line-height:1.45;color:#111}
  h1{margin-top:0}
  label{display:block;margin:10px 0 4px;font-weight:600}
  textarea{width:100%;height:220px;padding:8px;font-family:Menlo,monospace,monospace;white-space:pre;overflow:auto}
  .row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
  input[type="text"], select{padding:6px;border:1px solid #ccc;border-radius:6px}
  button{padding:8px 12px;border-radius:6px;border:1px solid #888;background:#f3f3f3;cursor:pointer}
  .output{width:100%;padding:8px;height:110px;overflow:auto;background:#fafafa;border:1px dashed #ccc;border-radius:6px}
  .note{color:#666;font-size:0.95em}
  .warn{color:#9a3a00;font-weight:700}
  footer{margin-top:18px;color:#666;font-size:0.9em}
</style>
</head>
<body>
<h1>HTML → Data URL（或 base64）工具</h1>
<p class="note">將 HTML 貼上或上傳檔案，選擇編碼方式，按「產生」，然後複製／打開或下載。適合短到中等長度的 HTML（若內容過大或有大量資源，請使用伺服器或檔案方式）。</p>

<label for="file">上傳 HTML 檔案（可選）</label>
<input id="file" type="file" accept=".html,text/html" />

<label for="html">或貼上 HTML（優先使用上傳內容）</label>
<textarea id="html" placeholder="在此貼上或編輯 HTML..."></textarea>

<div class="row">
  <label for="method">編碼方式：</label>
  <select id="method">
    <option value="uri">URL encode（encodeURIComponent） — 可直接放網址列</option>
    <option value="base64">base64（data:text/html;base64,） — 有時較穩定</option>
  </select>

  <label for="charset">字元集：</label>
  <select id="charset">
    <option value="utf-8">utf-8</option>
    <option value="windows-1252">windows-1252</option>
  </select>

  <button id="generate">產生</button>
  <button id="open" title="在新分頁打開（若被阻擋請改用複製並貼上網址列）">在新分頁打開</button>
  <button id="copy">複製網址到剪貼簿</button>
  <button id="download">下載為 .url 檔案</button>
</div>

<p class="note">網址長度：<span id="length">0</span> 字元。若超過瀏覽器限制（通常幾千到幾萬字元）可能無法使用。</p>
<div class="output" id="output" contenteditable="true"></div>

<p class="warn" id="warn" style="display:none">警告：網址過長或包含大量資源，瀏覽器可能會阻擋或截斷。考慮使用本機檔案或簡單本地伺服器。</p>

<hr>
<h3>備註與提示</h3>
<ul>
  <li>若 HTML 有非 ASCII 字元，建議使用 <strong>utf-8 + base64</strong> 或 URL encode（encodeURIComponent）。</li>
  <li>若要把小段 JavaScript 做成 bookmarklet，請把 HTML 轉為 JS 串接（頁面也內建簡單工具可改造）。</li>
  <li>若需要把 CSS/圖檔等打包進去，建議用工具打包成單檔（例如用 <code>inline</code> 或服務端）。</li>
</ul>

<footer>建立時間：2025-12-10（工具離線運作、無網路請求）</footer>

<script>
const fileInput = document.getElementById('file');
const textarea = document.getElementById('html');
const generateBtn = document.getElementById('generate');
const output = document.getElementById('output');
const lengthEl = document.getElementById('length');
const warnEl = document.getElementById('warn');
const copyBtn = document.getElementById('copy');
const openBtn = document.getElementById('open');
const downloadBtn = document.getElementById('download');
const methodSel = document.getElementById('method');
const charsetSel = document.getElementById('charset');

// Helper to base64-encode Unicode string (UTF-8)
function base64EncodeUnicode(str) {
  // encode as utf-8, then to base64
  const utf8Bytes = new TextEncoder().encode(str);
  let binary = '';
  const chunk = 0x8000;
  for (let i = 0; i < utf8Bytes.length; i += chunk) {
    binary += String.fromCharCode.apply(null, Array.from(utf8Bytes.subarray(i, i + chunk)));
  }
  return btoa(binary);
}

fileInput.addEventListener('change', async (e) => {
  const f = e.target.files[0];
  if (!f) return;
  const text = await f.text();
  textarea.value = text;
});

function makeDataURL(html, method, charset) {
  if (method === 'uri') {
    const encoded = encodeURIComponent(html);
    return `data:text/html;charset=${charset},${encoded}`;
  } else if (method === 'base64') {
    const b64 = base64EncodeUnicode(html);
    return `data:text/html;charset=${charset};base64,${b64}`;
  }
  return '';
}

generateBtn.addEventListener('click', () => {
  const html = textarea.value || '';
  const method = methodSel.value;
  const charset = charsetSel.value;
  const url = makeDataURL(html, method, charset);
  output.textContent = url;
  lengthEl.textContent = url.length;
  warnEl.style.display = url.length > 10000 ? 'block' : 'none';
});

copyBtn.addEventListener('click', async () => {
  const text = output.textContent;
  if (!text) return alert('先產生網址');
  try {
    await navigator.clipboard.writeText(text);
    alert('已複製到剪貼簿');
  } catch (err) {
    // fallback
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); alert('已複製到剪貼簿（備援）'); } catch(e){ alert('複製失敗，請手動選取並複製'); }
    ta.remove();
  }
});

openBtn.addEventListener('click', () => {
  const text = output.textContent;
  if (!text) return alert('先產生網址');
  // Try opening in new tab
  const w = window.open();
  if (!w) {
    alert('新分頁被阻擋。請複製並在網址列貼上或允許彈出視窗。');
    return;
  }
  w.location.href = text;
});

downloadBtn.addEventListener('click', () => {
  const text = output.textContent;
  if (!text) return alert('先產生網址');
  // create .url text file (simple shortcut file for Windows). Also allow .txt download.
  const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'data-url.txt';
  document.body.appendChild(a);
  a.click();
  a.remove();
});
</script>
</body>
</html>